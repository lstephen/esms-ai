image: maven:3-jdk-8

environment:
  - GIT_AUTHOR_NAME
  - GIT_AUTHOR_EMAIL

volumes:
  - .m2/:/root/.m2

targets:
  build: mvn -B verify -Dgpg.skip=true

  install: mvn -B install -Dgpg.skip=true

  clean: mvn -B clean

  update-versions: mvn -B versions:update-properties -DgenerateBackupPoms=false

  site: mvn -B clean site

  run:
    before:
      - install
    volumes:
      - $GIT_SSH_KEY:/ssh/id_rsa:ro
      - esms-ai-data/:/var/esms-ai-data
    environment:
      - ESMSAI_SITE
      - ESMSAI_DATA=/var/esms-ai-data
    run: /bin/bash construi/run/run.sh

