<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SquadReport.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">esms-ai</a> &gt; <a href="index.source.html" class="el_package">com.ljs.ifootballmanager.ai.report</a> &gt; <span class="el_source">SquadReport.java</span></div><h1>SquadReport.java</h1><pre class="source lang-java linenums">package com.ljs.ifootballmanager.ai.report;

import com.google.common.base.Function;
import com.google.common.collect.Iterables;
import com.google.common.collect.Ordering;
import com.ljs.ifootballmanager.ai.Role;
import com.ljs.ifootballmanager.ai.Tactic;
import com.ljs.ifootballmanager.ai.league.League;
import com.ljs.ifootballmanager.ai.math.Maths;
import com.ljs.ifootballmanager.ai.player.Player;
import com.ljs.ifootballmanager.ai.rating.Rating;
import com.ljs.ifootballmanager.ai.value.RatingInRole;
import com.ljs.ifootballmanager.ai.value.ReplacementLevel;
import com.ljs.ifootballmanager.ai.value.ReplacementLevelHolder;
import com.ljs.ifootballmanager.ai.value.Value;
import java.io.PrintWriter;

/**
 *
 * @author lstephen
 */
public class SquadReport implements Report {

    private final League league;

    private final Tactic tactic;

    private final Iterable&lt;Player&gt; squad;

    private Ordering&lt;Player&gt; ordering;

    private Value value;

<span class="nc" id="L34">    private SquadReport(League league, Tactic tactic, Iterable&lt;Player&gt; squad) {</span>
<span class="nc" id="L35">        this.league = league;</span>
<span class="nc" id="L36">        this.tactic = tactic;</span>
<span class="nc" id="L37">        this.squad = squad;</span>

<span class="nc" id="L39">        ordering = Player.byOverall(tactic).reverse().compound(Player.byTieBreak());</span>
<span class="nc" id="L40">        value = league.getPlayerValue();</span>
<span class="nc" id="L41">    }</span>

    private Double getValue(Player p) {
<span class="nc" id="L44">        Double ovr = value.getValue(p);</span>
<span class="nc" id="L45">        Double vsRepl = ReplacementLevelHolder.get().getValueVsReplacement(p);</span>

<span class="nc" id="L47">        Player atPotential = league.getPlayerPotential().atPotential(p);</span>

<span class="nc bnc" id="L49" title="All 2 branches missed.">        if (ovr &lt; value.getValue(atPotential)) {</span>
<span class="nc" id="L50">            vsRepl = Math.max(0, vsRepl);</span>
<span class="nc" id="L51">            vsRepl = Math.max(vsRepl, ReplacementLevelHolder.get().getValueVsReplacement(atPotential));</span>
        }

<span class="nc" id="L54">        return ovr + vsRepl;</span>
    }

    public SquadReport sortByValue() {
<span class="nc" id="L58">        ordering = Ordering</span>
<span class="nc" id="L59">            .natural()</span>
<span class="nc" id="L60">            .reverse()</span>
<span class="nc" id="L61">            .onResultOf(new Function&lt;Player, Long&gt;() {</span>
                public Long apply(Player p) {
<span class="nc" id="L63">                    return Math.round(getValue(p));</span>
                }
            })
<span class="nc" id="L66">            .compound(Player.byTieBreak());</span>
<span class="nc" id="L67">        return this;</span>
    }

    public SquadReport sortByValue(Value value) {
<span class="nc" id="L71">        this.value = value;</span>
<span class="nc" id="L72">        ordering = Player.byValue(value).reverse();</span>
<span class="nc" id="L73">        return this;</span>
    }

    public void print(PrintWriter w) {
<span class="nc" id="L77">        Role[] roles = Role.values();</span>
<span class="nc" id="L78">        Tactic[] tactics = Tactic.values();</span>

<span class="nc" id="L80">        ReplacementLevel repl = ReplacementLevelHolder.get();</span>

<span class="nc" id="L82">        w.format(&quot;%-15s &quot;, tactic);</span>

<span class="nc" id="L84">        w.format(&quot;%2s %2s %8s %3s &quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;OVR&quot;);</span>

<span class="nc bnc" id="L86" title="All 2 branches missed.">        for (Role r : roles) {</span>
<span class="nc" id="L87">            w.format(&quot;%3s &quot;, r.name());</span>
        }

<span class="nc" id="L90">        w.format(&quot;| %3s %7s || %3s || &quot;, &quot;VAL&quot;, &quot; vsRpl&quot;, &quot;&quot;);</span>

<span class="nc bnc" id="L92" title="All 2 branches missed.">        for (Tactic t : tactics) {</span>
<span class="nc" id="L93">            w.format(&quot;%3s    &quot;, t.getCode());</span>
        }

<span class="nc" id="L96">        w.println();</span>

<span class="nc bnc" id="L98" title="All 2 branches missed.">        for (Player p : ordering.immutableSortedCopy(squad)) {</span>
<span class="nc" id="L99">            w.format(&quot;%-15s &quot;, p.getName());</span>

<span class="nc" id="L101">            RatingInRole best = p.getOverall(tactic);</span>

<span class="nc" id="L103">            String skills = String.format(</span>
                &quot;%2d/%2d/%2d&quot;,
<span class="nc" id="L105">                Math.round(p.getSkill(Rating.TACKLING)),</span>
<span class="nc" id="L106">                Math.round(p.getSkill(Rating.PASSING)),</span>
<span class="nc" id="L107">                Math.round(p.getSkill(Rating.SHOOTING)));</span>

<span class="nc bnc" id="L109" title="All 2 branches missed.">            if (p.getPrimarySkill() == Rating.STOPPING) {</span>
<span class="nc" id="L110">                skills = String.format(&quot;   %d   &quot;, Math.round(p.getSkill(Rating.STOPPING)));</span>
            }

<span class="nc" id="L113">            w.format(&quot;%2d %2s %8s %3d &quot;,</span>
<span class="nc" id="L114">                p.getAge(),</span>
<span class="nc" id="L115">                best.getRole(),</span>
                skills,
<span class="nc" id="L117">                Maths.round(best.getRating()));</span>

<span class="nc bnc" id="L119" title="All 2 branches missed.">            for (Role r : roles) {</span>
<span class="nc" id="L120">                w.format(&quot;%3d &quot;, Maths.round(p.evaluate(r, tactic).getRating()));</span>
            }

<span class="nc" id="L123">            Double ovr = value.getValue(p);</span>
<span class="nc" id="L124">            Double vsRepl = repl.getValueVsReplacement(p);</span>

<span class="nc" id="L126">            w.format(</span>
                &quot;| %3d %3d/%3d || %3d || &quot;,
<span class="nc" id="L128">                Maths.round(ovr),</span>
<span class="nc" id="L129">                Maths.round(vsRepl),</span>
<span class="nc" id="L130">                Maths.round(repl.getValueVsReplacement(league.getPlayerPotential().atPotential(p))),</span>
<span class="nc" id="L131">                Maths.round(getValue(p)));</span>

<span class="nc bnc" id="L133" title="All 2 branches missed.">            for (Tactic t : tactics) {</span>
<span class="nc" id="L134">                RatingInRole rir = p.getOverall(t);</span>
<span class="nc" id="L135">                w.format(</span>
                    &quot;%3d%3s &quot;,
<span class="nc" id="L137">                    Maths.round(rir.getRating()),</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">                    rir.getRole() == best.getRole() ? &quot;&quot; : &quot; &quot; + rir.getRole());</span>
            }

<span class="nc" id="L141">            w.format(</span>
                &quot;%s%1s%1s &quot;,
<span class="nc" id="L143">                p.getRosterStatus(),</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">                Iterables.contains(league.getForcedPlay(), p.getName()) ? &quot;F&quot; : &quot;&quot;,</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">                league.isReserveEligible(p) ? &quot;r&quot; : &quot;&quot;);</span>

<span class="nc" id="L147">            w.format(&quot;%s&quot;, p.getComment());</span>

<span class="nc" id="L149">            w.println();</span>
<span class="nc" id="L150">        }</span>

<span class="nc" id="L152">    }</span>

    public static SquadReport create(League league, Tactic tactic, Iterable&lt;Player&gt; squad) {
<span class="nc" id="L155">        return new SquadReport(league, tactic, squad);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span></div></body></html>