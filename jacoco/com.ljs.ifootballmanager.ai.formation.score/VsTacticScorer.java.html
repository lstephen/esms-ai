<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>VsTacticScorer.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">esms-ai</a> &gt; <a href="index.source.html" class="el_package">com.ljs.ifootballmanager.ai.formation.score</a> &gt; <span class="el_source">VsTacticScorer.java</span></div><h1>VsTacticScorer.java</h1><pre class="source lang-java linenums">package com.ljs.ifootballmanager.ai.formation.score;

import com.ljs.ifootballmanager.ai.Role;
import com.ljs.ifootballmanager.ai.Tactic;
import com.ljs.ifootballmanager.ai.formation.Formation;
import com.ljs.ifootballmanager.ai.math.Maths;
import com.ljs.ifootballmanager.ai.player.Player;
import com.ljs.ifootballmanager.ai.rating.Rating;
import java.io.PrintWriter;

/**
 *
 * @author lstephen
 */
public final class VsTacticScorer implements FormationScorer {

    private final Tactic vs;

<span class="nc" id="L19">    private VsTacticScorer(Tactic vs) {</span>
<span class="nc" id="L20">        this.vs = vs;</span>
<span class="nc" id="L21">    }</span>

    public Double score(Formation f, Tactic tactic) {

<span class="nc" id="L25">        Double a = scoring(f, tactic);</span>
<span class="nc" id="L26">        Double d = defending(f, tactic);</span>

<span class="nc" id="L28">        Double avg = (a + d) / 2;</span>

<span class="nc" id="L30">        Double aterm = a / (avg + 1);</span>
<span class="nc" id="L31">        Double dterm = avg / (d + 1);</span>

<span class="nc" id="L33">        Double pct = 1 + aterm - dterm;</span>

<span class="nc" id="L35">        return (a + d) * pct + gkBonus(f, tactic) + shootingBonus(f, tactic);</span>
    }

    public Double scoring(Formation f, Tactic tactic) {
<span class="nc" id="L39">        Double shooting = skillRating(f, tactic, Rating.SHOOTING);</span>
<span class="nc" id="L40">        Double passing = skillRating(f, tactic, Rating.PASSING);</span>

<span class="nc" id="L42">        return (passing + passing + shooting) / 3;</span>
    }

    public Double defending(Formation f, Tactic tactic) {
<span class="nc" id="L46">        return skillRating(f, tactic, Rating.TACKLING);</span>
    }

    public Double shootingBonus(Formation f, Tactic tactic) {
<span class="nc" id="L50">        Double a = scoring(f, tactic);</span>
<span class="nc" id="L51">        Double d = defending(f, tactic);</span>

<span class="nc" id="L53">        Double avg = (a + d) / 2;</span>

<span class="nc" id="L55">        Double base = (9 * shotQuality(f, tactic) + cornerShotQuality(f)) / 10;</span>

<span class="nc" id="L57">        return a/avg * base;</span>
    }

    public Double gkBonus(Formation f, Tactic t) {
<span class="nc" id="L61">        Double a = scoring(f, t);</span>
<span class="nc" id="L62">        Double d = defending(f, t);</span>

<span class="nc" id="L64">        Double avg = (a + d) / 2;</span>

<span class="nc" id="L66">        return avg/d * gkQuality(f);</span>
    }

    public Double shotQuality(Formation f, Tactic t) {
<span class="nc" id="L70">        Double score = 0.0;</span>

<span class="nc" id="L72">        Double shooting = skillRating(f, t, Rating.SHOOTING);</span>

<span class="nc bnc" id="L74" title="All 2 branches missed.">        for (Player p : f.unsortedPlayers()) {</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">            if (f.findRole(p) == Role.GK) {</span>
<span class="nc" id="L76">                continue;</span>
            }
<span class="nc" id="L78">            Double chance = p.getSkillRating(f.findRole(p), t, Rating.SHOOTING, vs) / shooting;</span>

<span class="nc" id="L80">            score += (chance * p.getSkill(Rating.SHOOTING));</span>
<span class="nc" id="L81">        }</span>

<span class="nc" id="L83">        return score;</span>
    }

    private Double cornerShotQuality(Formation f) {
<span class="nc" id="L87">        Double total = 0.0;</span>

<span class="nc bnc" id="L89" title="All 2 branches missed.">        for (Player p : f.unsortedPlayers()) {</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">            if (f.findRole(p) == Role.GK) {</span>
<span class="nc" id="L91">                continue;</span>
            }
<span class="nc" id="L93">            total += p.getSkill(Rating.SHOOTING) + 10;</span>
<span class="nc" id="L94">        }</span>

<span class="nc" id="L96">        Double score = 0.0;</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">        for (Player p : f.unsortedPlayers()) {</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">            if (f.findRole(p) == Role.GK) {</span>
<span class="nc" id="L99">                continue;</span>
            }
<span class="nc" id="L101">            Double chance = (p.getSkill(Rating.SHOOTING) + 10) / total;</span>

<span class="nc" id="L103">            score += chance * p.getSkill(Rating.SHOOTING);</span>
<span class="nc" id="L104">        }</span>

<span class="nc" id="L106">        return score;</span>
    }

    public Double gkQuality(Formation f) {
<span class="nc" id="L110">        return f.players(Role.GK).iterator().next().getSkill(Rating.STOPPING);</span>
    }

    private Double teamAggression(Formation f) {
<span class="nc" id="L114">        Double sum = aggression(f) * 11;</span>

<span class="nc" id="L116">        return 0.75*sum + 0.25 * 10 * sum;</span>
    }

    private Double aggression(Formation f) {
<span class="nc" id="L120">        Double agg = 0.0;</span>

<span class="nc bnc" id="L122" title="All 2 branches missed.">        for (Player p : f.unsortedPlayers()) {</span>
<span class="nc" id="L123">            agg += p.getAggression();</span>
<span class="nc" id="L124">        }</span>

<span class="nc" id="L126">        return agg / 11;</span>
    }

    public Double skillRating(Formation f, Tactic t, Rating r) {
<span class="nc" id="L130">        Double score = 0.0;</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">        for (Player p : f.unsortedPlayers()) {</span>
<span class="nc" id="L132">            score += p.getSkillRating(f.findRole(p), t, r, vs);</span>
<span class="nc" id="L133">        }</span>
<span class="nc" id="L134">        return score;</span>
    }

    private Double outfieldPlayerSkillTotal(Formation f, Rating r) {
<span class="nc" id="L138">        Double score = 0.0;</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">        for (Player p : f.unsortedPlayers()) {</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">            if (f.findRole(p) == Role.GK) {</span>
<span class="nc" id="L141">                continue;</span>
            }
<span class="nc" id="L143">            score += p.getSkill(r);</span>
<span class="nc" id="L144">        }</span>
<span class="nc" id="L145">        return score;</span>
    }

    public void print(Formation f, PrintWriter w) {
<span class="nc" id="L149">        Tactic[] tactics = Tactic.values();</span>

<span class="nc" id="L151">        w.format(&quot;%10s &quot;, &quot;&quot;);</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">        for (Tactic t : tactics) {</span>
<span class="nc" id="L153">            w.format(&quot;%7s &quot;, t.getCode());</span>
        }
<span class="nc" id="L155">        w.println();</span>

<span class="nc bnc" id="L157" title="All 2 branches missed.">        for (Rating rt : Rating.values()) {</span>
<span class="nc" id="L158">            w.format(&quot;%10s &quot;, rt);</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">            for (Tactic t : tactics) {</span>
<span class="nc" id="L160">                w.format(&quot;%7d &quot;, Maths.round(skillRating(f, t, rt)));</span>
            }
<span class="nc" id="L162">            w.println();</span>
        }

<span class="nc" id="L165">        w.format(&quot;%10s &quot;, &quot;SH Qual&quot;);</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">        for (Tactic t : tactics) {</span>
<span class="nc" id="L167">            w.format(&quot;%7d &quot;, Maths.round(shotQuality(f, t)));</span>
        }
<span class="nc" id="L169">        w.println();</span>

<span class="nc" id="L171">        w.format(&quot;%10s &quot;, &quot;C SH Qual&quot;);</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">        for (Tactic t : tactics) {</span>
<span class="nc" id="L173">            w.format(&quot;%7d &quot;, Maths.round(cornerShotQuality(f)));</span>
        }
<span class="nc" id="L175">        w.println();</span>

<span class="nc" id="L177">        w.format(&quot;%10s &quot;, &quot;SH Bonus&quot;);</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">        for (Tactic t : tactics) {</span>
<span class="nc" id="L179">            w.format(&quot;%7d &quot;, Maths.round(shootingBonus(f, t)));</span>
        }
<span class="nc" id="L181">        w.println();</span>

<span class="nc" id="L183">        w.format(&quot;%10s &quot;, &quot;GK Qual&quot;);</span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">        for (Tactic t : tactics) {</span>
<span class="nc" id="L185">            w.format(&quot;%7d &quot;, Maths.round(gkQuality(f)));</span>
        }
<span class="nc" id="L187">        w.println();</span>

<span class="nc" id="L189">        w.format(&quot;%10s &quot;, &quot;GK Bonus&quot;);</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">        for (Tactic t : tactics) {</span>
<span class="nc" id="L191">            w.format(&quot;%7d &quot;, Maths.round(gkBonus(f, t)));</span>
        }
<span class="nc" id="L193">        w.println();</span>

<span class="nc" id="L195">        w.format(&quot;%10s &quot;, &quot;Agg&quot;);</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">        for (Tactic t : tactics) {</span>
<span class="nc" id="L197">            w.format(&quot;%7d &quot;, Maths.round(aggression(f)));</span>
        }
<span class="nc" id="L199">        w.println();</span>

<span class="nc" id="L201">        w.format(&quot;%10s &quot;, &quot;Scoring&quot;);</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">        for (Tactic t : tactics) {</span>
<span class="nc" id="L203">            w.format(&quot;%7d &quot;, Maths.round(scoring(f, t)));</span>
        }
<span class="nc" id="L205">        w.println();</span>

<span class="nc" id="L207">        w.format(&quot;%10s &quot;, &quot;Defending&quot;);</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">        for (Tactic t : tactics) {</span>
<span class="nc" id="L209">            w.format(&quot;%7d &quot;, Maths.round(defending(f, t)));</span>
        }
<span class="nc" id="L211">        w.println();</span>

<span class="nc" id="L213">        w.format(&quot;%10s &quot;, &quot;Overall&quot;);</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">        for (Tactic t : tactics) {</span>
<span class="nc" id="L215">            w.format(&quot;%7d &quot;, Maths.round(score(f, t)));</span>
        }
<span class="nc" id="L217">        w.println();</span>
<span class="nc" id="L218">    }</span>

    public static VsTacticScorer create(Tactic vs) {
<span class="nc" id="L221">        return new VsTacticScorer(vs);</span>
    }


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span></div></body></html>